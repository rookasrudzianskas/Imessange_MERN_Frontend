(this["webpackJsonpimessage-clone-yt"]=this["webpackJsonpimessage-clone-yt"]||[]).push([[0],{105:function(e,a,t){},106:function(e,a,t){},107:function(e,a,t){},108:function(e,a,t){},109:function(e,a,t){"use strict";t.r(a);var n=t(0),c=t.n(n),s=t(16),i=t.n(s),r=(t(70),t(9)),l=(t(74),t(24)),o=Object(l.b)({name:"user",initialState:{user:null},reducers:{login:function(e,a){e.user=a.payload},logout:function(e){e.user=null}}}),m=o.actions,u=m.login,d=m.logout,f=function(e){return e.user.user},b=o.reducer,p=t(17),h=t(124),g=t(58),E=t.n(g),v=(t(75),Object(l.b)({name:"chat",initialState:{chatId:null,chatName:null},reducers:{setChat:function(e,a){e.chatId=a.payload.chatId,e.chatName=a.payload.chatName}}})),O=v.actions.setChat,N=function(e){return e.chat.chatName},w=function(e){return e.chat.chatId},j=v.reducer,I=t(28),_=t.n(I),k=(_.a.initializeApp({apiKey:"AIzaSyAQ7jLQczjbSkOqNQaG9zBNjgKu92Mk_gQ",authDomain:"rookas-imessage-mern-app.firebaseapp.com",projectId:"rookas-imessage-mern-app",storageBucket:"rookas-imessage-mern-app.appspot.com",messagingSenderId:"383445998242",appId:"1:383445998242:web:af5f066cc90b96a11e55fb",measurementId:"G-844MYFTZJ5"}).firestore(),_.a.auth()),y=new _.a.auth.GoogleAuthProvider,S=t(126),C=(t(86),Object(n.forwardRef)((function(e,a){e.id;var t=e.sender,n=e.message,s=e.timestamp,i=Object(r.c)(f);return c.a.createElement("div",{ref:a,className:"message ".concat(i.email===t.email&&"message__sender")},c.a.createElement(S.a,{className:"message__photo",src:t.photo}),c.a.createElement("p",null,n),c.a.createElement("small",null,new Date(parseInt(s)).toDateString()))}))),J=t(57),M=t(56),Y=t.n(M).a.create({baseURL:"https://rookas-imessage-mern-backend.herokuapp.com"}),D=t(22),L=t.n(D),T=new L.a("117ff3ca7fcf393a58b3",{cluster:"eu"});var Z=function(){var e=Object(r.c)(f),a=Object(n.useState)(""),t=Object(p.a)(a,2),s=t[0],i=t[1],l=Object(r.c)(N),o=Object(r.c)(w),m=Object(n.useState)([]),u=Object(p.a)(m,2),d=u[0],b=u[1],g=function(e){e&&Y.get("/get/conversation?id=".concat(e)).then((function(e){b(e.data[0].conversation)}))};return Object(n.useEffect)((function(){T.unsubscribe("messages"),g(o),T.subscribe("messages").bind("newMessage",(function(e){g(o)}))}),[o]),c.a.createElement("div",{className:"chat"},c.a.createElement("div",{className:"chat__header"},c.a.createElement("h4",null,"To: ",c.a.createElement("span",{className:"chat__name"},l)),c.a.createElement("strong",null,"Details")),c.a.createElement("div",{className:"chat__messages"},c.a.createElement(J.a,null,d.map((function(e){var a=e.user,t=e._id,n=e.message,s=e.timestamp;return c.a.createElement(C,{key:t,id:t,sender:a,message:n,timestamp:s})})))),c.a.createElement("div",{className:"chat__input"},c.a.createElement("form",null,c.a.createElement("input",{value:s,onChange:function(e){return i(e.target.value)},placeholder:"iMessage",type:"text"}),c.a.createElement("button",{onClick:function(a){a.preventDefault(),Y.post("/new/message?id=".concat(o),{message:s,timestamp:Date.now(),user:e}),i("")}},"Send Message")),c.a.createElement(h.a,null,c.a.createElement(E.a,{className:"chat__mic"}))))},z=(t(105),t(106),t(59)),Q=t.n(z),W=t(60),A=t.n(W),G=(t(107),t(111),new L.a("117ff3ca7fcf393a58b3",{cluster:"eu"}));var U=function(e){var a=e.id,t=e.chatName,s=Object(r.b)(),i=Object(n.useState)([]),l=Object(p.a)(i,2),o=(l[0],l[1],Object(n.useState)("")),m=Object(p.a)(o,2),u=m[0],d=m[1],f=Object(n.useState)(""),b=Object(p.a)(f,2),h=b[0],g=b[1],E=Object(n.useState)(""),v=Object(p.a)(E,2),N=v[0],w=v[1],j=function(){Y.get("/get/lastMessage?id=".concat(a)).then((function(e){d(e.data.message),g(e.data.user.photo),w(e.data.timestamp)}))};return Object(n.useEffect)((function(){j(),G.subscribe("messages").bind("newMessage",(function(e){j()}))}),[a]),c.a.createElement("div",{onClick:function(){return s(O({chatId:a,chatName:t}))},className:"sidebarChat"},c.a.createElement(S.a,{src:h}),c.a.createElement("div",{className:"sidebarChat__info"},c.a.createElement("h3",null,t),c.a.createElement("p",null,u),c.a.createElement("small",null,new Date(parseInt(N)).toUTCString())))},B=new L.a("117ff3ca7fcf393a58b3",{cluster:"eu"});var x=function(){var e=Object(r.c)(f),a=Object(n.useState)([]),t=Object(p.a)(a,2),s=t[0],i=t[1],l=function(){Y.get("/get/conversationList").then((function(e){i(e.data)}))};return Object(n.useEffect)((function(){l(),B.subscribe("chats").bind("newChat",(function(e){l()}))}),[]),c.a.createElement("div",{className:"sidebar"},c.a.createElement("div",{className:"sidebar__header"},c.a.createElement(S.a,{onClick:function(){return k.signOut()},src:e.photo,className:"sidebar__avatar"}),c.a.createElement("div",{className:"sidebar__input"},c.a.createElement(Q.a,null),c.a.createElement("input",{placeholder:"Search"})),c.a.createElement(h.a,{variant:"outlined",className:"sidebar__inputButton"},c.a.createElement(A.a,{onClick:function(){var a=prompt("Please enter a chat name"),t=prompt("Please send a welcome message");if(a&&t){var n="";Y.post("/new/conversation",{chatName:a}).then((function(e){n=e.data._id})).then((function(){Y.post("/new/message?id=".concat(n),{message:t,timestamp:Date.now(),user:e})}))}}}))),c.a.createElement("div",{className:"sidebar__chats"},s.map((function(e){var a=e.id,t=e.name,n=e.timestamp;return c.a.createElement(U,{key:a,id:a,chatName:t,timestamp:n})}))))};var F=function(){return c.a.createElement("div",{className:"imessage"},c.a.createElement(x,null),c.a.createElement(Z,null))},R=t(125);t(108);var V=function(){return c.a.createElement("div",{className:"login"},c.a.createElement("div",{className:"login__logo"},c.a.createElement("img",{src:"https://images-wixmp-ed30a86b8c4ca887773594c2.wixmp.com/f/a60c69b4-dbdc-49e3-b152-43bbdbfb0160/d6dy6qy-19e320f2-932f-4549-8050-2b7fb9289eda.png?token=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ1cm46YXBwOiIsImlzcyI6InVybjphcHA6Iiwib2JqIjpbW3sicGF0aCI6IlwvZlwvYTYwYzY5YjQtZGJkYy00OWUzLWIxNTItNDNiYmRiZmIwMTYwXC9kNmR5NnF5LTE5ZTMyMGYyLTkzMmYtNDU0OS04MDUwLTJiN2ZiOTI4OWVkYS5wbmcifV1dLCJhdWQiOlsidXJuOnNlcnZpY2U6ZmlsZS5kb3dubG9hZCJdfQ.AQSIo8n9g9HHLZFVdCwqbDOjFg9DwZI35LCTIuLgtEw",alt:""}),c.a.createElement("h1",null,"iMessage")),c.a.createElement(R.a,{onClick:function(){k.signInWithPopup(y).catch((function(e){return alert(e.message)}))}},"Sign In"))};var q=function(){var e=Object(r.c)(f),a=Object(r.b)();return Object(n.useEffect)((function(){k.onAuthStateChanged((function(e){a(e?u({uid:e.uid,photo:e.photoURL,email:e.email,displayName:e.displayName}):d())}))}),[]),c.a.createElement("div",{className:"app"},e?c.a.createElement(F,null):c.a.createElement(V,null))},P=Object(l.a)({reducer:{user:b,chat:j}});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(r.a,{store:P},c.a.createElement(q,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},65:function(e,a,t){e.exports=t(109)},70:function(e,a,t){},74:function(e,a,t){},75:function(e,a,t){},86:function(e,a,t){}},[[65,1,2]]]);
//# sourceMappingURL=main.a53851df.chunk.js.map